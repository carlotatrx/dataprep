df,
outfile = filename,
outpath = outdir,
cod     = code,
lat     = lat,
lon     = lon,
alt     = alt,
sou     = source,
link    = link,
nam     = name,
var     = var,
stat    = "point",
units   = ifelse(var=="w", "Ben Nevis scale", units(var)),
meta    = df$Meta,
metaHead = ifelse(var=="p", "PTC=Y | PGC=Y", ""),
keep_na = FALSE
)
qc(glue(indir,dirname,filename_full), outpath=glue(indir, dirname))
d
for (var in c('rh', 'w')){#r', 'ta', 'p', 'w', 'rh')) {
meta_col <- if (var == "p") "meta_p" else "meta_time"
df <- raw %>%
select(Year, Month, Day, Hour, Minute, all_of(var), all_of(meta_col)) %>%
rename(Value = all_of(var), Meta = all_of(meta_col)) %>%
drop_na(Value)
filename <- outfile.name(name, var, df, TRUE)
filename_full <- paste0(filename, ".tsv")
write_sef_f(
df,
outfile = filename,
outpath = outdir,
cod     = code,
lat     = lat,
lon     = lon,
alt     = alt,
sou     = source,
link    = link,
nam     = name,
var     = var,
stat    = "point",
units   = ifelse(var=="w", "Ben Nevis scale", units(var)),
meta    = df$Meta,
metaHead = ifelse(var=="p", "PTC=Y | PGC=Y", ""),
keep_na = FALSE
)
qc(glue(indir,dirname,filename_full), outpath=glue(indir, dirname))
qcfilename <- paste0("qc_BEN NEVIS SUMMIT OBSERVATORY_",var,"_subdaily.txt")
write_flags_f(infile=glue(indir,dirname,filename_full),
qcfile=glue(indir,dirname, qcfilename),
outpath=glue(indir,dirname),
match=FALSE)
}
indir <- '/scratch3/PALAEO-RA/daily_data/final/'
### quick one
dirname <- "Channel_Island/"
filename <- "Weather-data-rescue-v2-2_Langlois_Channel-Island_18650101-18751231_p_subdaily.tsv"
qc(glue(indir,dirname,filename), outpath=glue(indir, dirname))
filename <- "Weather-data-rescue-v2-2_Unknown_Channel-Island_18640101-18641002_p_subdaily.tsv"
qc(glue(indir,dirname,filename), outpath=glue(indir, dirname))
filename <- "Weather-data-rescue-v2-2_Vibert_Channel-Island_18760101-18860131_p_subdaily.tsv"
qc(glue(indir,dirname,filename), outpath=glue(indir, dirname))
qcfilename <- "qc_JERSEY-CHANNEL-ISLAND-VIBERT_p_subdaily.txt"
write_flags_f(infile=glue(indir,dirname,filename),
qcfile=glue(indir,dirname, qcfilename),
outpath=glue(indir,dirname),
match=FALSE)
### loop
indir <- "/scratch3/PALAEO-RA/daily_data/final/Aberdeen/"
files <- list.files(indir, pattern = "\\.tsv$", full.names = TRUE)
files
for (f in files) {
qc(f, outpath = indir)
qcfile <- file.path(
indir,
paste0("qc_", tools::file_path_sans_ext(basename(f)), ".txt")
)
write_flags_f(
infile  = f,
qcfile  = qcfile,
outpath = indir,
match   = FALSE
)
}
?qc
qc
### loop
dir <- "/scratch3/PALAEO-RA/daily_data/final/Aberdeen/"
tsv_files <- list.files(dir, pattern="\\.tsv$", full.names=TRUE)
qc_files  <- list.files(dir, pattern="^qc_.*\\.txt$", full.names=TRUE)
# helpers -------------------------------------------------------------
get_res <- function(x) {
if (grepl("_subdaily\\b", x)) "subdaily"
else if (grepl("_daily\\b", x)) "daily"
else NA_character_
}
get_var_data <- function(x) {
bn <- basename(x)
# WDRv2.2_Aberdeen_18610301-18750331_ta_bis_subdaily.tsv  -> ta_bis
sub("^.*_([A-Za-z][A-Za-z0-9]*)_(subdaily|daily)\\.tsv$", "\\1", bn)
}
get_var_qc <- function(x) {
bn <- basename(x)
# qc_DWRUK_ABERDEEN_Tn_daily.txt -> Tn
sub("^qc_.*?_([A-Za-z][A-Za-z0-9]*)_(subdaily|daily)\\.txt$", "\\1", bn)
}
norm_var <- function(v) {
# adjust here if you want ta_bis to use ta QC rules
if (v == "ta_bis") "ta" else v
}
# build QC lookup: key = "var|res" -----------------------------------
qc_key <- paste0(norm_var(get_var_qc(qc_files)), "|", get_res(qc_files))
qc_map <- setNames(qc_files, qc_key)
# build QC lookup: key = "var|res" -----------------------------------
qc_key <- paste0(norm_var(get_var_qc(qc_files)), "|", get_res(qc_files))
for (f in files) {
qc(f, outpath = indir)
qcfile <- file.path(
indir,
paste0("qc_", tools::file_path_sans_ext(basename(f)), ".txt")
)
}
qc_files  <- list.files(indir, pattern="^qc_.*\\.txt$", full.names=TRUE)
qc_files
files
### loop
indir <- "/scratch3/PALAEO-RA/daily_data/final/Aberdeen"
indir <- '/scratch3/PALAEO-RA/daily_data/final/'
### quick one
dirname <- "Aberdeen"
files <- list.files(indir, pattern = "\\.tsv$", full.names = TRUE)
files
files <- list.files(paste0(indir, dirname, sep="/"), pattern = "\\.tsv$", full.names = TRUE)
fiels
files
files <- list.files(paste0(indir, dirname), pattern = "\\.tsv$", full.names = TRUE)
files
for (f in files) {
qc(f, outpath = indir)
qcfile <- file.path(
indir,
paste0("qc_", tools::file_path_sans_ext(basename(f)), ".txt")
)
}
qc_files  <- list.files(paste0(indir, dirname), pattern="^qc_.*\\.txt$", full.names=TRUE)
qc_files
files
qc_files
filename <- "WDRv2.2_Aberdeen_18611211-18750331_rr_daily.tsv"
qc(glue(indir,dirname,filename), outpath=glue(indir, dirname))
qcfilename <- "qc_DWRUK_ABERDEEN_rr_subdaily.txt"
write_flags_f(infile=glue(indir,dirname,filename),
qcfile=glue(indir,dirname, qcfilename),
outpath=glue(indir,dirname),
match=FALSE)
### quick one
dirname <- "Aberdeen/"
write_flags_f(infile=glue(indir,dirname,filename),
qcfile=glue(indir,dirname, qcfilename),
outpath=glue(indir,dirname),
match=FALSE)
qcfilename <- "qc_DWRUK_ABERDEEN_ta_subdaily.txt"
filename <- "WDRv2.2_Aberdeen_18610301-18750331_ta_subdaily.tsv"
qc(glue(indir,dirname,filename), outpath=glue(indir, dirname))
qcfilename <- "qc_DWRUK_ABERDEEN_ta_subdaily.txt"
write_flags_f(infile=glue(indir,dirname,filename),
qcfile=glue(indir,dirname, qcfilename),
outpath=glue(indir,dirname),
match=FALSE)
filename <- "WDRv2.2_Aberdeen_18610301-18750331_ta_bis_subdaily.tsv"
qc(glue(indir,dirname,filename), outpath=glue(indir, dirname))
qcfilename <- "qc_DWRUK_ABERDEEN_ta_subdaily.txt"
write_flags_f(infile=glue(indir,dirname,filename),
qcfile=glue(indir,dirname, qcfilename),
outpath=glue(indir,dirname),
match=FALSE)
filename <- "WDRv2.2_Aberdeen_18610301-18750331_ta_bis_subdaily.tsv"
qc(glue(indir,dirname,filename), outpath=glue(indir, dirname))
filename <- "WDRv2.2_Aberdeen_18720114-18750331_Tn_daily.tsv"
qcfilename <- "qc_DWRUK_ABERDEEN_Tn_daily.txt"
write_flags_f(infile=glue(indir,dirname,filename),
qcfile=glue(indir,dirname, qcfilename),
outpath=glue(indir,dirname),
match=FALSE)
filename <- "WDRv2.2_Aberdeen_18720114-18750331_Tx_daily.tsv"
qcfilename <- "qc_DWRUK_ABERDEEN_Tx_daily.txt"
write_flags_f(infile=glue(indir,dirname,filename),
qcfile=glue(indir,dirname, qcfilename),
outpath=glue(indir,dirname),
match=FALSE)
### loop
indir <- "/scratch3/PALAEO-RA/daily_data/final/Androssan"
files <- list.files(paste0(indir, dirname), pattern = "\\.tsv$", full.names = TRUE)
files
indir <- '/scratch3/PALAEO-RA/daily_data/final/'
### quick one
dirname <- "Androssan/"
files <- list.files(paste0(indir, dirname), pattern = "\\.tsv$", full.names = TRUE)
files
indir <- '/scratch3/PALAEO-RA/daily_data/final/'
### quick one
dirname <- "Androssan/"
files <- list.files(paste0(indir, dirname), pattern = "\\.tsv$", full.names = TRUE)
files
indir
### quick one
dirname <- "Ardrossan/"
files <- list.files(paste0(indir, dirname), pattern = "\\.tsv$", full.names = TRUE)
files
for (f in files) {
qc(f, outpath = indir)
qcfile <- file.path(
indir,
paste0("qc_", tools::file_path_sans_ext(basename(f)), ".txt")
)
}
qc_files  <- list.files(paste0(indir, dirname), pattern="^qc_.*\\.txt$", full.names=TRUE)
qc_files
rm(list=ls())
library(dataresqc)
library(hclim)
source('/home/ccorbella/scratch2_symboliclink/code/dataprep/helpfun.R')
library(glue)
indir <- '/scratch3/PALAEO-RA/daily_data/final/'
### quick one
dirname <- "Bayonne/"
files <- list.files(paste0(indir, dirname), pattern = "\\.tsv$", full.names = TRUE)
files
for (f in files) {
qc(f, outpath = indir)
qcfile <- file.path(
indir,
paste0("qc_", tools::file_path_sans_ext(basename(f)), ".txt")
)
}
qc_files  <- list.files(paste0(indir, dirname), pattern="^qc_.*\\.txt$", full.names=TRUE)
qc_files
### quick one
dirname <- "Berick/"
files <- list.files(paste0(indir, dirname), pattern = "\\.tsv$", full.names = TRUE)
files
for (f in files) {
qc(f, outpath = indir)
qcfile <- file.path(
indir,
paste0("qc_", tools::file_path_sans_ext(basename(f)), ".txt")
)
}
indir <- '/scratch3/PALAEO-RA/daily_data/final/'
### quick one
dirname <- "Berick/"
files <- list.files(paste0(indir, dirname), pattern = "\\.tsv$", full.names = TRUE)
files
paste0(indir, dirname)
### quick one
dirname <- "Berwick/"
files <- list.files(paste0(indir, dirname), pattern = "\\.tsv$", full.names = TRUE)
files
for (f in files) {
qc(f, outpath = indir)
qcfile <- file.path(
indir,
paste0("qc_", tools::file_path_sans_ext(basename(f)), ".txt")
)
}
qc_files  <- list.files(paste0(indir, dirname), pattern="^qc_.*\\.txt$", full.names=TRUE)
qc_files
### quick one
dirname <- "Biarritz/"
files <- list.files(paste0(indir, dirname), pattern = "\\.tsv$", full.names = TRUE)
files
for (f in files) {
qc(f, outpath = indir)
qcfile <- file.path(
indir,
paste0("qc_", tools::file_path_sans_ext(basename(f)), ".txt")
)
}
qc_files  <- list.files(paste0(indir, dirname), pattern="^qc_.*\\.txt$", full.names=TRUE)
qc_files
for (f in files) {
qc(f, outpath = paste0(indir,dirname))
qcfile <- file.path(
indir,
paste0("qc_", tools::file_path_sans_ext(basename(f)), ".txt")
)
}
qc_files  <- list.files(paste0(indir, dirname), pattern="^qc_.*\\.txt$", full.names=TRUE)
qc_files
qcfilename <- "qc_DWRUK_BIARRITZ_Tx_daily.txt"
filename <- "WRDv2.2_Biarritz_18680425-18750331_rr_daily.tsv"
qcfilename <- "qc_DWRUK_BIARRITZ_Tx_daily.txt"
write_flags_f(infile=glue(indir,dirname,filename),
qcfile=glue(indir,dirname, qcfilename),
outpath=glue(indir,dirname),
match=FALSE)
qcfilename <- "qc_DWRUK_BIARRITZ_rr_daily.txt"
write_flags_f(infile=glue(indir,dirname,filename),
qcfile=glue(indir,dirname, qcfilename),
outpath=glue(indir,dirname),
match=FALSE)
filename <- "WRDv2.2_Biarritz_18720114-18750331_Tx_daily.tsv"
qc(glue(indir,dirname,filename), outpath=glue(indir, dirname))
qcfilename <- "qc_DWRUK_BIARRITZ_Tx_daily.txt"
write_flags_f(infile=glue(indir,dirname,filename),
qcfile=glue(indir,dirname, qcfilename),
outpath=glue(indir,dirname),
match=FALSE)
qcfilename <- "qc_DWRUK_BIARRITZ_ta_subdaily.txt"
filename <- "WRDv2.2_Biarritz_18680425-18750331_ta_subdaily.tsv"
qcfilename <- "qc_DWRUK_BIARRITZ_ta_subdaily.txt"
write_flags_f(infile=glue(indir,dirname,filename),
qcfile=glue(indir,dirname, qcfilename),
outpath=glue(indir,dirname),
match=FALSE)
### quick one
dirname <- "Berwick/"
filename <- "WRDv2.2_Berwick_18610301-18621227_ta_bis_subdaily.tsv"
qcfilename <- "qc_DWRUK_BERWICK_tb_subdaily.txt"
write_flags_f(infile=glue(indir,dirname,filename),
qcfile=glue(indir,dirname, qcfilename),
outpath=glue(indir,dirname),
match=FALSE)
filename <- "WRDv2.2_Berwick_18610301-18621227_ta_bis_subdaily.tsv"
qcfilename <- "qc_DWRUK_BERWICK_ta_subdaily.txt"
write_flags_f(infile=glue(indir,dirname,filename),
qcfile=glue(indir,dirname, qcfilename),
outpath=glue(indir,dirname),
match=FALSE)
rm(list=ls())
library(dataresqc)
library(hclim)
source('/home/ccorbella/scratch2_symboliclink/code/dataprep/helpfun.R')
library(glue)
indir <- '/scratch3/PALAEO-RA/daily_data/final/'
### quick one
dirname <- "Brest/"
files <- list.files(paste0(indir, dirname), pattern = "\\.tsv$", full.names = TRUE)
files
for (f in files) {
qc(f, outpath = paste0(indir,dirname))
qcfile <- file.path(
indir,
paste0("qc_", tools::file_path_sans_ext(basename(f)), ".txt")
)
}
qc_files  <- list.files(paste0(indir, dirname), pattern="^qc_.*\\.txt$", full.names=TRUE)
qc_files
filename <- "WRDv2.2_Brest_18610830-18750331_ta_subdaily.tsv"
qcfilename <- "qc_DWRUK_BREST_ta_subdaily.txt"
write_flags_f(infile=glue(indir,dirname,filename),
qcfile=glue(indir,dirname, qcfilename),
outpath=glue(indir,dirname),
match=FALSE)
filename <- "WRDv2.2_Brest_18720114-18750331_Tn_daily.tsv"
qcfilename <- "qc_DWRUK_BREST_Tn_daily.txt"
write_flags_f(infile=glue(indir,dirname,filename),
qcfile=glue(indir,dirname, qcfilename),
outpath=glue(indir,dirname),
match=FALSE)
filename <- "WRDv2.2_Brest_18720114-18750331_Tx_daily.tsv"
qcfilename <- "qc_DWRUK_BREST_Tx_daily.txt"
write_flags_f(infile=glue(indir,dirname,filename),
qcfile=glue(indir,dirname, qcfilename),
outpath=glue(indir,dirname),
match=FALSE)
filename <- "WRDv2.2_Brest_18621219-18750331_rr_daily.tsv"
qcfilename <- "qc_DWRUK_BREST_rr_subdaily.txt"
write_flags_f(infile=glue(indir,dirname,filename),
qcfile=glue(indir,dirname, qcfilename),
outpath=glue(indir,dirname),
match=FALSE)
### quick one
dirname <- "Brussels/"
filename <- "WRDv2.2_Brussels_18680102-18750331_p.tsv"
qc(glue(indir,dirname,filename), outpath=glue(indir, dirname))
filename <- "WRDv2.2_Brussels_18680102-18750331_ta.tsv"
qc(glue(indir,dirname,filename), outpath=glue(indir, dirname))
qc_files  <- list.files(paste0(indir, dirname), pattern="^qc_.*\\.txt$", full.names=TRUE)
qc_files
### quick one
dirname <- "Cambridge/"
files <- list.files(paste0(indir, dirname), pattern = "\\.tsv$", full.names = TRUE)
files
for (f in files) {
qc(f, outpath = paste0(indir,dirname))
qcfile <- file.path(
indir,
paste0("qc_", tools::file_path_sans_ext(basename(f)), ".txt")
)
}
qc_files  <- list.files(paste0(indir, dirname), pattern="^qc_.*\\.txt$", full.names=TRUE)
qc_files
files
filename<-files[4]
qcfilename <- "qc_DWRUK_CAMBRIDGE_Tn_daily.txt"
write_flags_f(infile=glue(indir,dirname,filename),
qcfile=glue(indir,dirname, qcfilename),
outpath=glue(indir,dirname),
match=FALSE)
filename <- "/WRDv2.2_Cambridge_18720701-18750331_Tn_daily.tsv"
write_flags_f(infile=glue(indir,dirname,filename),
qcfile=glue(indir,dirname, qcfilename),
outpath=glue(indir,dirname),
match=FALSE)
### quick one
dirname <- "Capeclear/"
files <- list.files(paste0(indir, dirname), pattern = "\\.tsv$", full.names = TRUE)
files
for (f in files) {
qc(f, outpath = paste0(indir,dirname))
qcfile <- file.path(
indir,
paste0("qc_", tools::file_path_sans_ext(basename(f)), ".txt")
)
}
qc_files  <- list.files(paste0(indir, dirname), pattern="^qc_.*\\.txt$", full.names=TRUE)
qc_files
### quick one
dirname <- "Cap_Gris-Nez/"
files <- list.files(paste0(indir, dirname), pattern = "\\.tsv$", full.names = TRUE)
files
for (f in files) {
qc(f, outpath = paste0(indir,dirname))
qcfile <- file.path(
indir,
paste0("qc_", tools::file_path_sans_ext(basename(f)), ".txt")
)
}
qc_files  <- list.files(paste0(indir, dirname), pattern="^qc_.*\\.txt$", full.names=TRUE)
qc_files
qcfilename <- "qc_DWRUK_CAPGRISNEZ_daily.txt"
files
filename <- "WRDv2.2_Cap-Griz-Nez_18720114-18750331_Tn_daily.tsv"
qcfilename <- "qc_DWRUK_CAPGRISNEZ_daily.txt"
qcfilename <- "qc_DWRUK_CAPGRISNEZ_Tn_daily.txt"
write_flags_f(infile=glue(indir,dirname,filename),
qcfile=glue(indir,dirname, qcfilename),
outpath=glue(indir,dirname),
match=FALSE)
qcfilename <- "qc_DWRUK_CAPGRISNEZ_Tx_daily.txt"
filename <- "WRDv2.2_Cap-Griz-Nez_18720114-18750331_Tx_daily.tsv"
write_flags_f(infile=glue(indir,dirname,filename),
qcfile=glue(indir,dirname, qcfilename),
outpath=glue(indir,dirname),
match=FALSE)
qcfilename <- "qc_DWRUK_CAPGRISNEZ_rr_subdaily.txt"
filename <- "WRDv2.2_Cap-Griz-Nez_18680614-18750331_rr_daily.tsv"
qcfilename <- "qc_DWRUK_CAPGRISNEZ_rr_subdaily.txt"
write_flags_f(infile=glue(indir,dirname,filename),
qcfile=glue(indir,dirname, qcfilename),
outpath=glue(indir,dirname),
match=FALSE)
### quick one
dirname <- "Cuxhaven/"
files <- list.files(paste0(indir, dirname), pattern = "\\.tsv$", full.names = TRUE)
files
for (f in files) {
qc(f, outpath = paste0(indir,dirname))
qcfile <- file.path(
indir,
paste0("qc_", tools::file_path_sans_ext(basename(f)), ".txt")
)
}
qc_files  <- list.files(paste0(indir, dirname), pattern="^qc_.*\\.txt$", full.names=TRUE)
qc_files
for (f in files) {
qc(f, outpath = paste0(indir,dirname))
qcfile <- file.path(
indir,
paste0("qc_", tools::file_path_sans_ext(basename(f)), ".txt")
)
}
qc(f, outpath = paste0(indir,dirname))
f
rm(list=ls())
library(dataresqc)
library(hclim)
source('/home/ccorbella/scratch2_symboliclink/code/dataprep/helpfun.R')
library(glue)
indir <- '/scratch3/PALAEO-RA/daily_data/final/'
### quick one
dirname <- "Dover/"
files <- list.files(paste0(indir, dirname), pattern = "\\.tsv$", full.names = TRUE)
files
for (f in files) {
qc(f, outpath = paste0(indir,dirname))
qcfile <- file.path(
indir,
paste0("qc_", tools::file_path_sans_ext(basename(f)), ".txt")
)
}
qc(f, outpath = paste0(indir,dirname))
f
f<-files[2]
qc(f, outpath = paste0(indir,dirname))
paste0(indir,dirname)
### quick one
dirname <- "Dover"
files <- list.files(paste0(indir, dirname), pattern = "\\.tsv$", full.names = TRUE)
files
for (f in files) {
qc(f, outpath = paste0(indir,dirname))
qcfile <- file.path(
indir,
paste0("qc_", tools::file_path_sans_ext(basename(f)), ".txt")
)
}
filename <- "WRDv2.2_Dover_18610301-18750331_ta_barometer_subdaily.tsv"
qc(glue(indir,dirname,filename), outpath=glue(indir, dirname))
### quick one
dirname <- "Dover/"
qc(glue(indir,dirname,filename), outpath=glue(indir, dirname))
