qcfile=glue(indir,dirname, qcfilename),
outpath=glue(indir,dirname),
match=FALSE)
qcfilename <- "qc_DWRUK_BIARRITZ_rr_daily.txt"
write_flags_f(infile=glue(indir,dirname,filename),
qcfile=glue(indir,dirname, qcfilename),
outpath=glue(indir,dirname),
match=FALSE)
filename <- "WRDv2.2_Biarritz_18720114-18750331_Tx_daily.tsv"
qc(glue(indir,dirname,filename), outpath=glue(indir, dirname))
qcfilename <- "qc_DWRUK_BIARRITZ_Tx_daily.txt"
write_flags_f(infile=glue(indir,dirname,filename),
qcfile=glue(indir,dirname, qcfilename),
outpath=glue(indir,dirname),
match=FALSE)
qcfilename <- "qc_DWRUK_BIARRITZ_ta_subdaily.txt"
filename <- "WRDv2.2_Biarritz_18680425-18750331_ta_subdaily.tsv"
qcfilename <- "qc_DWRUK_BIARRITZ_ta_subdaily.txt"
write_flags_f(infile=glue(indir,dirname,filename),
qcfile=glue(indir,dirname, qcfilename),
outpath=glue(indir,dirname),
match=FALSE)
### quick one
dirname <- "Berwick/"
filename <- "WRDv2.2_Berwick_18610301-18621227_ta_bis_subdaily.tsv"
qcfilename <- "qc_DWRUK_BERWICK_tb_subdaily.txt"
write_flags_f(infile=glue(indir,dirname,filename),
qcfile=glue(indir,dirname, qcfilename),
outpath=glue(indir,dirname),
match=FALSE)
filename <- "WRDv2.2_Berwick_18610301-18621227_ta_bis_subdaily.tsv"
qcfilename <- "qc_DWRUK_BERWICK_ta_subdaily.txt"
write_flags_f(infile=glue(indir,dirname,filename),
qcfile=glue(indir,dirname, qcfilename),
outpath=glue(indir,dirname),
match=FALSE)
rm(list=ls())
library(dataresqc)
library(hclim)
source('/home/ccorbella/scratch2_symboliclink/code/dataprep/helpfun.R')
library(glue)
indir <- '/scratch3/PALAEO-RA/daily_data/final/'
### quick one
dirname <- "Brest/"
files <- list.files(paste0(indir, dirname), pattern = "\\.tsv$", full.names = TRUE)
files
for (f in files) {
qc(f, outpath = paste0(indir,dirname))
qcfile <- file.path(
indir,
paste0("qc_", tools::file_path_sans_ext(basename(f)), ".txt")
)
}
qc_files  <- list.files(paste0(indir, dirname), pattern="^qc_.*\\.txt$", full.names=TRUE)
qc_files
filename <- "WRDv2.2_Brest_18610830-18750331_ta_subdaily.tsv"
qcfilename <- "qc_DWRUK_BREST_ta_subdaily.txt"
write_flags_f(infile=glue(indir,dirname,filename),
qcfile=glue(indir,dirname, qcfilename),
outpath=glue(indir,dirname),
match=FALSE)
filename <- "WRDv2.2_Brest_18720114-18750331_Tn_daily.tsv"
qcfilename <- "qc_DWRUK_BREST_Tn_daily.txt"
write_flags_f(infile=glue(indir,dirname,filename),
qcfile=glue(indir,dirname, qcfilename),
outpath=glue(indir,dirname),
match=FALSE)
filename <- "WRDv2.2_Brest_18720114-18750331_Tx_daily.tsv"
qcfilename <- "qc_DWRUK_BREST_Tx_daily.txt"
write_flags_f(infile=glue(indir,dirname,filename),
qcfile=glue(indir,dirname, qcfilename),
outpath=glue(indir,dirname),
match=FALSE)
filename <- "WRDv2.2_Brest_18621219-18750331_rr_daily.tsv"
qcfilename <- "qc_DWRUK_BREST_rr_subdaily.txt"
write_flags_f(infile=glue(indir,dirname,filename),
qcfile=glue(indir,dirname, qcfilename),
outpath=glue(indir,dirname),
match=FALSE)
### quick one
dirname <- "Brussels/"
filename <- "WRDv2.2_Brussels_18680102-18750331_p.tsv"
qc(glue(indir,dirname,filename), outpath=glue(indir, dirname))
filename <- "WRDv2.2_Brussels_18680102-18750331_ta.tsv"
qc(glue(indir,dirname,filename), outpath=glue(indir, dirname))
qc_files  <- list.files(paste0(indir, dirname), pattern="^qc_.*\\.txt$", full.names=TRUE)
qc_files
### quick one
dirname <- "Cambridge/"
files <- list.files(paste0(indir, dirname), pattern = "\\.tsv$", full.names = TRUE)
files
for (f in files) {
qc(f, outpath = paste0(indir,dirname))
qcfile <- file.path(
indir,
paste0("qc_", tools::file_path_sans_ext(basename(f)), ".txt")
)
}
qc_files  <- list.files(paste0(indir, dirname), pattern="^qc_.*\\.txt$", full.names=TRUE)
qc_files
files
filename<-files[4]
qcfilename <- "qc_DWRUK_CAMBRIDGE_Tn_daily.txt"
write_flags_f(infile=glue(indir,dirname,filename),
qcfile=glue(indir,dirname, qcfilename),
outpath=glue(indir,dirname),
match=FALSE)
filename <- "/WRDv2.2_Cambridge_18720701-18750331_Tn_daily.tsv"
write_flags_f(infile=glue(indir,dirname,filename),
qcfile=glue(indir,dirname, qcfilename),
outpath=glue(indir,dirname),
match=FALSE)
### quick one
dirname <- "Capeclear/"
files <- list.files(paste0(indir, dirname), pattern = "\\.tsv$", full.names = TRUE)
files
for (f in files) {
qc(f, outpath = paste0(indir,dirname))
qcfile <- file.path(
indir,
paste0("qc_", tools::file_path_sans_ext(basename(f)), ".txt")
)
}
qc_files  <- list.files(paste0(indir, dirname), pattern="^qc_.*\\.txt$", full.names=TRUE)
qc_files
### quick one
dirname <- "Cap_Gris-Nez/"
files <- list.files(paste0(indir, dirname), pattern = "\\.tsv$", full.names = TRUE)
files
for (f in files) {
qc(f, outpath = paste0(indir,dirname))
qcfile <- file.path(
indir,
paste0("qc_", tools::file_path_sans_ext(basename(f)), ".txt")
)
}
qc_files  <- list.files(paste0(indir, dirname), pattern="^qc_.*\\.txt$", full.names=TRUE)
qc_files
qcfilename <- "qc_DWRUK_CAPGRISNEZ_daily.txt"
files
filename <- "WRDv2.2_Cap-Griz-Nez_18720114-18750331_Tn_daily.tsv"
qcfilename <- "qc_DWRUK_CAPGRISNEZ_daily.txt"
qcfilename <- "qc_DWRUK_CAPGRISNEZ_Tn_daily.txt"
write_flags_f(infile=glue(indir,dirname,filename),
qcfile=glue(indir,dirname, qcfilename),
outpath=glue(indir,dirname),
match=FALSE)
qcfilename <- "qc_DWRUK_CAPGRISNEZ_Tx_daily.txt"
filename <- "WRDv2.2_Cap-Griz-Nez_18720114-18750331_Tx_daily.tsv"
write_flags_f(infile=glue(indir,dirname,filename),
qcfile=glue(indir,dirname, qcfilename),
outpath=glue(indir,dirname),
match=FALSE)
qcfilename <- "qc_DWRUK_CAPGRISNEZ_rr_subdaily.txt"
filename <- "WRDv2.2_Cap-Griz-Nez_18680614-18750331_rr_daily.tsv"
qcfilename <- "qc_DWRUK_CAPGRISNEZ_rr_subdaily.txt"
write_flags_f(infile=glue(indir,dirname,filename),
qcfile=glue(indir,dirname, qcfilename),
outpath=glue(indir,dirname),
match=FALSE)
### quick one
dirname <- "Cuxhaven/"
files <- list.files(paste0(indir, dirname), pattern = "\\.tsv$", full.names = TRUE)
files
for (f in files) {
qc(f, outpath = paste0(indir,dirname))
qcfile <- file.path(
indir,
paste0("qc_", tools::file_path_sans_ext(basename(f)), ".txt")
)
}
qc_files  <- list.files(paste0(indir, dirname), pattern="^qc_.*\\.txt$", full.names=TRUE)
qc_files
for (f in files) {
qc(f, outpath = paste0(indir,dirname))
qcfile <- file.path(
indir,
paste0("qc_", tools::file_path_sans_ext(basename(f)), ".txt")
)
}
qc(f, outpath = paste0(indir,dirname))
f
rm(list=ls())
library(dataresqc)
library(hclim)
source('/home/ccorbella/scratch2_symboliclink/code/dataprep/helpfun.R')
library(glue)
indir <- '/scratch3/PALAEO-RA/daily_data/final/'
### quick one
dirname <- "Dover/"
files <- list.files(paste0(indir, dirname), pattern = "\\.tsv$", full.names = TRUE)
files
for (f in files) {
qc(f, outpath = paste0(indir,dirname))
qcfile <- file.path(
indir,
paste0("qc_", tools::file_path_sans_ext(basename(f)), ".txt")
)
}
qc(f, outpath = paste0(indir,dirname))
f
f<-files[2]
qc(f, outpath = paste0(indir,dirname))
paste0(indir,dirname)
### quick one
dirname <- "Dover"
files <- list.files(paste0(indir, dirname), pattern = "\\.tsv$", full.names = TRUE)
files
for (f in files) {
qc(f, outpath = paste0(indir,dirname))
qcfile <- file.path(
indir,
paste0("qc_", tools::file_path_sans_ext(basename(f)), ".txt")
)
}
filename <- "WRDv2.2_Dover_18610301-18750331_ta_barometer_subdaily.tsv"
qc(glue(indir,dirname,filename), outpath=glue(indir, dirname))
### quick one
dirname <- "Dover/"
qc(glue(indir,dirname,filename), outpath=glue(indir, dirname))
source("/scratch2/ccorbella/code/dataprep/indiv_series/Bolzano.R", echo=TRUE)
raw <- read.csv("/scratch3/PALAEO-RA/daily_data/original/Bolzano/Bolzano_1842-1849_raw.csv")
raw
head(raw)
raw['datetime']
raw['datetime'][1]
raw['datetime'][1,1]
dt <- ymd_hms(x)
head(raw)
df <- raw %>%
mutate(
dt = ymd_hms(datetime)
)
head(df)
df <- raw %>%
mutate(
dt = ymd_hms(datetime)
Year   = year(dt),
df <- raw %>%
mutate(
dt = ymd_hms(datetime),
Year   = year(dt),
Month  = month(dt),
Day    = day(dt),
Hour   = hour(dt),
Minute = minute(dt),
ta = round(Thermometer_Reaumur*1.25,2),
p = round(convert_pressure((Baromoter_Zoll+Barometer_Linien/12), f=26.34, lat=lat, alt=alt, atb=ta),2),
meta.time = meta_time(Hour, Minute),
meta.p = paste0(meta.time, " | orig=", Barometer_Zoll, "in", Barometer_Linien, "in | atb=", ta, "C"),
meta.ta = paste0(meta.time, " | orig=", Thermometer_Reaumur, "R")
)
rlang::last_trace()
raw %>%
filter(!is.na(Thermometer_Reaumur) & is.na(as.numeric(Thermometer_Reaumur)))
raw <- read.csv("/scratch3/PALAEO-RA/daily_data/original/Bolzano/Bolzano_1842-1849_raw.csv", na.strings = "NA")
df <- raw %>%
mutate(
dt = ymd_hms(datetime),
Year   = year(dt),
Month  = month(dt),
Day    = day(dt),
Hour   = hour(dt),
Minute = minute(dt),
ta = round(Thermometer_Reaumur*1.25,2),
p = round(convert_pressure((Baromoter_Zoll+Barometer_Linien/12), f=26.34, lat=lat, alt=alt, atb=ta),2),
meta.time = meta_time(Hour, Minute),
meta.p = paste0(meta.time, " | orig=", Barometer_Zoll, "in", Barometer_Linien, "in | atb=", ta, "C"),
meta.ta = paste0(meta.time, " | orig=", Thermometer_Reaumur, "R")
)
raw %>%
filter(!is.na(Thermometer_Reaumur) & is.na(as.numeric(Thermometer_Reaumur)))
raw <- read.csv("/scratch3/PALAEO-RA/daily_data/original/Bolzano/Bolzano_1842-1849_raw.csv", na.strings = c("NA","?"))
raw %>%
filter(!is.na(Thermometer_Reaumur) & is.na(as.numeric(Thermometer_Reaumur)))
df <- raw %>%
mutate(
dt = ymd_hms(datetime),
Year   = year(dt),
Month  = month(dt),
Day    = day(dt),
Hour   = hour(dt),
Minute = minute(dt),
ta = round(Thermometer_Reaumur*1.25,2),
p = round(convert_pressure((Baromoter_Zoll+Barometer_Linien/12), f=26.34, lat=lat, alt=alt, atb=ta),2),
meta.time = meta_time(Hour, Minute),
meta.p = paste0(meta.time, " | orig=", Barometer_Zoll, "in", Barometer_Linien, "in | atb=", ta, "C"),
meta.ta = paste0(meta.time, " | orig=", Thermometer_Reaumur, "R")
)
# -------------------------------------------------------------------------
lat <- 46.493
lon <- 11.341
alt <- 310
metaHead <- "coords=approx."
raw <- read.csv("/scratch3/PALAEO-RA/daily_data/original/Bolzano/Bolzano_1842-1849_raw.csv", na.strings = c("NA","?"))
df <- raw %>%
mutate(
dt = ymd_hms(datetime),
Year   = year(dt),
Month  = month(dt),
Day    = day(dt),
Hour   = hour(dt),
Minute = minute(dt),
ta = round(Thermometer_Reaumur*1.25,2),
p = round(convert_pressure((Baromoter_Zoll+Barometer_Linien/12), f=26.34, lat=lat, alt=alt, atb=ta),2),
meta.time = meta_time(Hour, Minute),
meta.p = paste0(meta.time, " | orig=", Barometer_Zoll, "in", Barometer_Linien, "in | atb=", ta, "C"),
meta.ta = paste0(meta.time, " | orig=", Thermometer_Reaumur, "R")
)
df <- raw %>%
mutate(
dt = ymd_hms(datetime),
Year   = year(dt),
Month  = month(dt),
Day    = day(dt),
Hour   = hour(dt),
Minute = minute(dt),
ta = round(Thermometer_Reaumur*1.25,2),
p = round(convert_pressure((Barometer_Zoll+Barometer_Linien/12), f=26.34, lat=lat, alt=alt, atb=ta),2),
meta.time = meta_time(Hour, Minute),
meta.p = paste0(meta.time, " | orig=", Barometer_Zoll, "in", Barometer_Linien, "in | atb=", ta, "C"),
meta.ta = paste0(meta.time, " | orig=", Thermometer_Reaumur, "R")
)
df
df <- raw %>%
mutate(
dt = ymd_hms(datetime),
Year   = year(dt),
Month  = month(dt),
Day    = day(dt),
Hour   = hour(dt),
Minute = minute(dt),
ta = round(Thermometer_Reaumur*1.25,2),
p = round(convert_pressure((Barometer_Zoll+Barometer_Linien/12), f=26.34, lat=lat, alt=alt, atb=ta),2),
meta.time = meta_time(Hour, Minute),
meta.p = paste0(meta.time, " | orig=", Barometer_Zoll, "in", Barometer_Linien, "in | atb=", ta, "C"),
meta.ta = paste0(meta.time, " | orig=", Thermometer_Reaumur, "R")
) %>% select(Year, Month, Day, Hour, Minute, p, ta, meta.p, meta.ta)
head(df)
df$p
min(df$p)
min(df$p, na.rm=T)
max(df$p, na.rm=T)
df <- raw %>%
mutate(
dt = ymd_hms(datetime),
Year   = year(dt),
Month  = month(dt),
Day    = day(dt),
Hour   = hour(dt),
Minute = minute(dt),
ta = round(Thermometer_Reaumur*1.25,2),
p = round(convert_pressure((Barometer_Zoll+Barometer_Linien/12), f=27.07, lat=lat, alt=alt, atb=ta),2),
meta.time = meta_time(Hour, Minute),
meta.p = paste0(meta.time, " | orig=", Barometer_Zoll, "in", Barometer_Linien, "in | atb=", ta, "C"),
meta.ta = paste0(meta.time, " | orig=", Thermometer_Reaumur, "R")
) %>% select(Year, Month, Day, Hour, Minute, p, ta, meta.p, meta.ta)
max(df$p, na.rm=T)
min(df$p, na.rm=T)
source <- "PALAEO-RA"
link <- ""
name <- "PALAEO-RA_Bolzano"
code <- "Bolzano"
# save
var <-"ta"
write_sef_f(
as.data.frame(df[,c("Year","Month", "Day", "Hour", "Minute", "ta"),]),
outfile = outfile.name(name, var, df, TRUE),
outpath = outdir,
cod     = code,
lat     = lat,
lon     = lon,
alt     = alt,
sou     = source,
link    = link,
nam     = name,
var     = var,
stat    = "point",
units   = units(var),
metaHead = metaHead,
meta    = df$meta.ta,
keep_na = TRUE
)
# save
var <-"p"
write_sef_f(
as.data.frame(df[,c("Year","Month", "Day", "Hour", "Minute", "p"),]),
outfile = outfile.name(name, var, df, TRUE),
outpath = outdir,
cod     = code,
lat     = lat,
lon     = lon,
alt     = alt,
sou     = source,
link    = link,
nam     = name,
var     = var,
stat    = "point",
units   = units(var),
metaHead = metaHead,
meta    = df$meta.p,
keep_na = TRUE
)
x <- read_xls("/scratch3/PALAEO-RA/DataRescue/Projects/Europe/2_Digitized/Lenke/Lenke_1709.xls", skip=5)
x
x[x["Station"]=="Königsberg"]
df.Koenigsberg <- x[x$Station == "Königsberg", ]
df.Koenigsberg <- raw[raw$Station == "Königsberg", ]
df.Koenigsberg
df.Koenigsberg <- raw[raw$Station == "Königsberg", ]
df.Koenigsberg
df.Koenigsberg <- raw %>% filter(trimws(Station) == "Königsberg")
raw
raw <- read_xls("/scratch3/PALAEO-RA/DataRescue/Projects/Europe/2_Digitized/Lenke/Lenke_1709.xls", skip=5)
raw
df.Koenigsberg <- raw %>% filter(trimws(Station) == "Königsberg")
df.Koenigsberg
rm(list=ls())
library(openxlsx)
install.packages('openxlsx')
library(openxlsx)
# directory with SEF files
indir <- "/scratch3/PALAEO-RA/daily_data/tmp/GHCNdRR/"
files <- list.files(indir, pattern = "\\.tsv$", full.names = TRUE)
files
get_meta <- function(f) {
h <- readLines(f, n = 20)
data.frame(
ID   = sub("^ID\\t",   "", h[grep("^ID\\t", h)]),
Name = sub("^Name\\t", "", h[grep("^Name\\t", h)]),
Lat  = as.numeric(sub("^Lat\\t", "", h[grep("^Lat\\t", h)])),
Lon  = as.numeric(sub("^Lon\\t", "", h[grep("^Lon\\t", h)])),
stringsAsFactors = FALSE
)
}
out <- do.call(rbind, lapply(files, get_meta))
write.xlsx(out, file = "/scratch3/PALAEO-RA/daily_data/tmp/GHCNdRR/GHCN_SEF_station_metadata.xlsx", overwrite = TRUE)
write.table(
out,
file = "GHCN_SEF_station_metadata.tsv",
sep = "\t",
row.names = FALSE,
quote = FALSE
)
write.table(
out,
file = "/scratch3/PALAEO-RA/daily_data/tmp/GHCNdRR/GHCN_SEF_station_metadata.tsv",
sep = "\t",
row.names = FALSE,
quote = FALSE
)
out
rm(list=ls())
library(openxlsx)
# directory with SEF files
indir <- "/scratch3/PALAEO-RA/daily_data/tmp/GHCNdRR/"
files <- list.files(indir, pattern = "\\.tsv$", full.names = TRUE)
get_meta <- function(f) {
h <- readLines(f, n = 20)
data.frame(
ID   = sub("^ID\\t",   "", h[grep("^ID\\t", h)]),
Name = sub("^Name\\t", "", h[grep("^Name\\t", h)]),
Lat  = as.numeric(sub("^Lat\\t", "", h[grep("^Lat\\t", h)])),
Lon  = as.numeric(sub("^Lon\\t", "", h[grep("^Lon\\t", h)])),
stringsAsFactors = FALSE
)
}
out <- do.call(rbind, lapply(files, get_meta))
files <- list.files(indir, pattern = "\\.tsv$", full.names = TRUE)
files
get_meta <- function(f) {
h <- readLines(f, n = 20)
data.frame(
ID   = sub("^ID\\t",   "", h[grep("^ID\\t", h)]),
Name = sub("^Name\\t", "", h[grep("^Name\\t", h)]),
Lat  = as.numeric(sub("^Lat\\t", "", h[grep("^Lat\\t", h)])),
Lon  = as.numeric(sub("^Lon\\t", "", h[grep("^Lon\\t", h)])),
stringsAsFactors = FALSE
)
}
out <- do.call(rbind, lapply(files, get_meta))
# directory with SEF files
indir <- "/scratch3/PALAEO-RA/daily_data/tmp/GHCNdRR"
files <- list.files(indir, pattern = "\\.tsv$", full.names = TRUE)
get_meta <- function(f) {
h <- readLines(f, n = 20)
data.frame(
ID   = sub("^ID\\t",   "", h[grep("^ID\\t", h)]),
Name = sub("^Name\\t", "", h[grep("^Name\\t", h)]),
Lat  = as.numeric(sub("^Lat\\t", "", h[grep("^Lat\\t", h)])),
Lon  = as.numeric(sub("^Lon\\t", "", h[grep("^Lon\\t", h)])),
stringsAsFactors = FALSE
)
}
out <- do.call(rbind, lapply(files, get_meta))
files
out <- do.call(rbind, lapply(files, get_meta))
head(files)
files <- list.files(indir, pattern = "^GHCN-D_.*\\.tsv$", full.names = TRUE)
get_meta <- function(f) {
h <- readLines(f, n = 20)
data.frame(
ID   = sub("^ID\\t",   "", h[grep("^ID\\t", h)]),
Name = sub("^Name\\t", "", h[grep("^Name\\t", h)]),
Lat  = as.numeric(sub("^Lat\\t", "", h[grep("^Lat\\t", h)])),
Lon  = as.numeric(sub("^Lon\\t", "", h[grep("^Lon\\t", h)])),
stringsAsFactors = FALSE
)
}
out <- do.call(rbind, lapply(files, get_meta))
out
write.xlsx(out, file = "/scratch3/PALAEO-RA/daily_data/tmp/GHCNdRR/GHCN_SEF_station_metadata_Europe.xlsx", overwrite = TRUE)
